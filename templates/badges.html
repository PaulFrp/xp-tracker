{% extends "base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XP Tracker</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body style="background-color: #e0e0e5">
    {% include "navbar.html" %}

    <h1>üèÖ Badges Unlocked</h1>
    
    {% if unlocked_badges %}
    <div class="badge-container">
        {% set badges_by_category = {} %}
        {% for badge in unlocked_badges %}
            {% set skill = badge['category'] %}
            {% set category = skill_to_category.get(skill, 'Unknown') %}
            {% if category not in badges_by_category %}
                {% set _ = badges_by_category.update({category: []}) %}
            {% endif %}
            {% set _ = badges_by_category[category].append(badge) %}
        {% endfor %}

        {% for category, badges in badges_by_category.items() %}
            <div class="badge-skill-box">
                <h2 class="category-title border-{{ category|lower }}">{{ category }}</h2>
                <div class="badge-grid">
                    {% for badge in badges %}
                        <div class="badgecard badge-border-{{ category|lower }} {% if badge['name'] in current_selected_badges %}selected{% endif %}"
                            data-title="{{ badge['name'] }}" data-level="{{ badge['description'] }}">
                            <img src="{{ url_for('static', filename=badge['image']) }}" alt="{{ badge['name'] }}" class="badge-image">
                            <span class="badge-title">{{ badge['name'] }}</span>
                            <p class="badge-description">{{ badge['description'] }}</p>
                            <input type="checkbox" class="checkbox" {% if badge['name'] in current_selected_badges %}checked{% endif %} hidden>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
    {% else %}
    <p>You haven't unlocked any badges yet. Level up a skill to level 10 to earn you first badge !</p>
    <p>Once you have earned a badge, you can select it to be displayed on your profile for everyone to see !</p>
    {% endif %}

    <script>

        
        //THAT SHIT I NEED TO REVIEW BECAUSE IT WORKS FOR SELECTING AND DESELECTING AND IT IS FUCKING DARK MAGIC


        // Handle clicking on title cards to toggle selection
        document.querySelectorAll('.badgecard').forEach(card => {
            card.addEventListener('click', function() {
                const title = card.getAttribute('data-title');
                const userId = "{{ user_id }}";  // Pass user ID from Flask to JavaScript
                const selected = card.classList.contains('selected');
                const level = card.getAttribute('data-level');

                // Toggle the selection state
                if (selected) {
                    card.classList.remove('selected');
                    card.querySelector('.checkbox').checked = false;
                    updateSelection(userId, title, 'remove');
                } else {
                    card.classList.add('selected');
                    card.querySelector('.checkbox').checked = true;
                    updateSelection(userId, title, 'add');
                }
                });
            });

        // Function to send the selection update to the server
        function updateSelection(userId, title, action) {
            fetch('/update_selected_badges', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    title: title,
                    action: action
                })
            });
        }
    </script>


</body>
{% endblock %}

