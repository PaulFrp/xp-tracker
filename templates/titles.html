{% extends "base.html" %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XP Tracker</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <nav style="background-color: #f8f9fa; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd;">
        <div style="display: flex; gap: 15px; align-items: center;">
            <a href="{{ url_for('index') }}" style="text-decoration: none; font-weight: bold; color: #333;">üè† Home</a>
            {% for category in ["Red", "Blue", "Green", "Gold"] %}
                <a href="/card_{{ category|lower }}" style="text-decoration: none; color: {{ category|lower }};">
                    {{ category }}
                </a>
            {% endfor %}
            <a href="{{ url_for('titles') }}" style="text-decoration: none; font-weight: bold; color: #333;"> Titles</a>
            <a  href=  "{{ url_for('badges')}}" style="text-decoration: none; font-weight: bold; color: #333"> Badges</a>
        </div>
        <div>
            <form method="POST" action="{{ url_for('logout') }}">
                <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
                    Logout
                </button>
            </form>
        </div>
    </nav>

    <h1>üèÖ Titles Unlocked</h1>

    {% if unlocked_titles %}
    <div class="titles-container">
        {% for skill, titles in unlocked_titles.items() %}
            {% set category = skill_to_category[skill] %}
            <div class="skill-box">
                <h2 class="category-title border-{{ category|lower }}">{{ skill }}</h2>
                <div class="title-grid">
                    {% for level, title in titles %}
                        <div class="title-card border-{{ category|lower }} {% if title in current_selected_titles %}selected{% endif %}"
                            data-title="{{ title }}" data-level="{{ level }}">
                            <span class="level">Lvl {{ level }}</span>
                            <span class="title">{{ title }}</span>
                            <input type="checkbox" class="checkbox" {% if title in current_selected_titles %}checked{% endif %} hidden>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
    {% else %}
    <p>You haven't unlocked any titles yet. Keep leveling up!</p>
    {% endif %}

    <script>

        
        //THAT SHIT I NEED TO REVIEW BECAUSE IT WORKS FOR SELECTING AND DESELECTING AND IT IS FUCKING DARK MAGIC


        // Handle clicking on title cards to toggle selection
        document.querySelectorAll('.title-card').forEach(card => {
            card.addEventListener('click', function() {
                const title = card.getAttribute('data-title');
                const userId = "{{ user_id }}";  // Pass user ID from Flask to JavaScript
                const selected = card.classList.contains('selected');
                const level = card.getAttribute('data-level');

                // Toggle the selection state
                if (selected) {
                    card.classList.remove('selected');
                    card.querySelector('.checkbox').checked = false;
                    updateSelection(userId, title, 'remove');
                } else {
                    card.classList.add('selected');
                    card.querySelector('.checkbox').checked = true;
                    updateSelection(userId, title, 'add');
                }
                });
            });

        // Function to send the selection update to the server
        function updateSelection(userId, title, action) {
            fetch('/update_selected_titles', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: userId,
                    title: title,
                    action: action
                })
            });
        }
    </script>

</body>
</html>
{% endblock %}
