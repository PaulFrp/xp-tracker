<!-- === templates/index.html === -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XP Tracker</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header>
        <section id="daily-challenges">
            <h2>ðŸ“… Daily Challenges</h2>
            <ul class="challenge-list">
            {% for challenge, completed in daily_challenges %}
            <li class="challenge-item">
                <div class="challenge-header">
                {{ challenge }}
                <button class="complete-btn-{{ challenge|replace(' ', '') }}" 
                    onclick="markComplete(this)" 
                    style="background-color: {{ 'white' if completed == 1 else 'initial' }};"
                    {% if completed == 1 %}disabled{% endif %}>
                    {{ "âœ… Done" if completed == 1 else "âœ” Completed" }}
                </button>
                </div>
                <progress value="{{ 100 if completed == 1 else 0 }}" max="100" 
                      class="{{ 'completed' if completed == 1 else '' }}"></progress>
            </li>
            {% endfor %}
            </ul>
        </section>
        
    </header>
    

    <main>
        <div class="category-grid">
            {% for category in ["Red", "Blue", "Green", "Gold"] %}
                <a href= "/card_{{category|lower}}" style = "text-decoration: none;">
                <div class="card {{ category|lower }}">
                    <img src="../static/images/icon_{{category|lower }}.png" alt="{{ category }} Icon" class="category-icon">
                    <div class="xp-bar-group">
                        {% for skill, cat, xp, level in stats %}
                            {% if cat == category %}
                                <div class="skill-bar">
                                    <span>{{ skill }} (Lvl {{ level }})</span>
                                    <div class="xp-bar">
                                        <div class="fill" style="width: {{ (xp / (level * 100)) * 100 }}%"></div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                </a>
            {% endfor %}
        </div>
        
    </main>

    <script>
        document.getElementById("xp-form").addEventListener("submit", async function (e) {
            e.preventDefault();
            const amount = document.getElementById("xp-amount").value;
            const skill = document.getElementById("skill-select").value;

            const response = await fetch("/add_xp", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ skill: skill, xp: amount })
            });

            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to add XP");
            }
        });

        document.getElementById("xp-delete-form").addEventListener("submit", async function (e) {
            e.preventDefault();
            const amount = document.getElementById("xp-delete-amount").value;
            const skill = document.getElementById("skill-delete-select").value;

            const response = await fetch("/delete_xp", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ skill: skill, xp: amount })
            });

            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to delete XP");
            }
        });


        function markComplete(button) {
            const challengeType = button.className.split('-')[2]; 
            
            fetch("/daily_challenges", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ challenge: challengeType })
            })
            .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to mark challenge as complete");
            }
            })
            .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while marking the challenge as complete");
            });
        }
    </script>
</body>
</html>
