{% extends "base.html" %}
{% block content %}
<!-- === templates/index.html === -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XP Tracker</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body style="background-color: #e0e0e5">
    {% include "navbar.html" %}
    
    
    <header>
        <h1 style="text-align: center;">Hello {{username}}</h1>

        {% if selected_badges %}
        <div style="text-align: center;" class="badges-container">
            <div class="skill-box">
            <div class="badge-grid" style="display: inline-block; text-align: center;">
                {% for badge in selected_badges %}
                <div class="badge-card" style="display: inline-block; margin: 10px;">
                    <img src="static/{{ badge_images[badge] }}" alt="{{ badge }}" style="width: 100px; height: 100px;">
                </div>
                {% endfor %}
            </div>
            </div>
        </div>
        {% endif %}

        {% if selected_titles %}
        <div style="text-align: center;" class="titles-container">
            <div class="skill-box">
                <div class="title-grid" style="display: inline-block; text-align: center;">
                    {% for title in selected_titles %}
                        {% set info = title_info[title] %}
                        {% set category = skill_to_category[info["skill"]] %}
                        <div class="title-card border-{{ category|lower }}" style="display: inline-block; margin: 10px;">
                            <span class="level">Lvl {{ info.level }}</span>
                            <span class="title">{{ title }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}

        <section id="daily-challenges">
            <h2>üìÖ Daily Challenges</h2>
            <ul class="challenge-list">
            {% for challenge, completed in daily_challenges %}
            <li class="challenge-item">
                <div class="challenge-header">
                {% if challenge == "Gym" %}
                    üí™ 100 Gym exercise
                {% elif challenge == "Running" %}
                    üèÉ Run 2.5km 
                {% elif challenge == "Reading" %}
                    üìñ Read 50 pages 
                {% elif challenge == "Work" %}
                    üíº Work 30min 
                {% else %}
                    {{ challenge }}
                {% endif %}
                <button class="complete-btn-{{ challenge|replace(' ', '') }}" 
                    onclick="markComplete(this)" 
                    style="background-color: {{ 'white' if completed == 1 else 'initial' }};"
                    {% if completed == 1 %}disabled{% endif %}>
                    {{ "‚úÖ Done" if completed == 1 else "‚úî Completed" }}
                </button>
                </div>
                <progress value="{{ 100 if completed == 1 else 0 }}" max="100" 
                      class="{{ 'completed' if completed == 1 else '' }}"></progress>
            </li>
            {% endfor %}
            </ul>
        </section>
        
    </header>
    

    <main>
        <div class="category-grid">
            {% for category in ["Red", "Blue", "Green", "Gold"] %}
                <a href= "/card_{{category|lower}}" style = "text-decoration: none;">
                <div class="card-main {{ category|lower }}">
                    <img src="../static/images/icons/icon_{{category|lower }}.png" alt="{{ category }} Icon" class="category-icon">
                    <div class="xp-bar-group">
                        {% for skill, cat, xp, level in stats %}
                            {% if cat == category %}
                                <div class="skill-bar">
                                    <span>{{ skill }} (Lvl {{ level }})</span>
                                    <div class="xp-bar">
                                        <div class="fill" style="width: {{ (xp / (level * 100)) * 100 }}%"></div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                </a>
            {% endfor %}
        </div>
        
    </main>

    <script>
        document.getElementById("xp-form").addEventListener("submit", async function (e) {
            e.preventDefault();
            const amount = document.getElementById("xp-amount").value;
            const skill = document.getElementById("skill-select").value;

            const response = await fetch("/add_xp", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ skill: skill, xp: amount })
            });

            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to add XP");
            }
        });

        document.getElementById("xp-delete-form").addEventListener("submit", async function (e) {
            e.preventDefault();
            const amount = document.getElementById("xp-delete-amount").value;
            const skill = document.getElementById("skill-delete-select").value;

            const response = await fetch("/delete_xp", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ skill: skill, xp: amount })
            });

            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to delete XP");
            }
        });


        function markComplete(button) {
            const challengeType = button.className.split('-')[2]; 
            
            fetch("/daily_challenges", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ challenge: challengeType })
            })
            .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert("Failed to mark challenge as complete");
            }
            })
            .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while marking the challenge as complete");
            });
        }
    </script>
</body>
</html>
{% endblock %}